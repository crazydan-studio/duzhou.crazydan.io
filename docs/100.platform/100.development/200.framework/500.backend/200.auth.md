---
title: 认证与鉴权
description: 了解认证与鉴权模块的技术实现
authors:
  - flytreleft
---

import Header from '../../../../\_header.md';

<Header />

- 所有资源（接口、页面、数据）都需要用户授权才可访问，
  不需要登录便可访问的资源，其本质是授权给了**匿名用户**，
  因此，匿名用户是一个特殊的系统用户，每次访问都会生成不同的
  `Access Token`
- **多租户支持**：不同租户有不同的权限范围
  - 通过差量机制提供实现上的支持
- 以站点做为前端资源组织结构的最顶层模型
  - 一个平台（`Platform`）可包含一个或多个应用（`Application`），
    每个应用可包含多个前端站点（`site`），
    每个前端站点可包含一个或多个资源（`resource`），
    每个资源可对应至多一个页面（`page`），
    每个页面可包含一个或多个操作（`action`），
    每个操作涉及一个或多个接口（`api`）
  - 每个站点、资源、操作和接口均根据用户权限（`permission`）做访问控制
  - 一个前端站点面对的是一类用户或某个场景，
    比如，用户登录、后台管理、门户等，均为不同的前端站点
  - 所有前端站点都需要做用户鉴权，不需要登录的前端站点，
    实际上是授权给了**匿名用户**，每个匿名用户也同样都有
    `Access Token`
    - 同一平台的多个应用之间可共享用户认证数据，
      所以，已认证用户可直接在多个应用之间无缝跳转，仅需要认证一次
- 提供前端资源的获取接口，返回各用户可访问的前端站点的 JSON 结构数据
  - 所有前端站点均采用 DSL 定义和生成，并根据用户权限动态增减可访问内容
  - 在开发阶段，在页面、资源、操作等结构数据中需包含其 DSL 定义的位置信息，
    以便于直接调试定位

## DSL

### Site

> 本平台针对的是动态的资源授权机制，不存在拥有固定权限的角色。

```xml
<sites>
  <site id="login" displayName="用户登录"
        layout="/path/to/login.layout.xml"
        url="/login">
    <resource id="user-login"
              url="/path/to/login.page.xml">
    </resource>
  </site>

  <site id="main" displayName="门户"
        layout="/path/to/main.layout.xml"
        url="/">
    <resource id="news"
              displayName="新闻"
              url="/path/to/news.page.xml">
    </resource>
    <resource id="blog"
              displayName="博客"
              url="/path/to/blog.page.xml">
    </resource>
    <resource id="admin"
              displayName="后台管理"
              url="redirect:/admin">
    </resource>
  </site>

  <site id="admin" displayName="后台管理"
        layout="/path/to/admin.layout.xml"
        url="/admin">
    <resource id="auth"
              displayName="权限管理"
              url="/path/to/auth.page.xml">
    </resource>
    <resource id="organization"
              displayName="组织管理"
              url="/path/to/org.page.xml">
    </resource>
  </site>
</sites>
```

> TODO 在独立的前端模块定义和管理 Site DSL？

- `site` 属性列表

> 从前端开发的角度来看，一个 `site`
> 实际上就是一个[单页面应用](https://blog.51cto.com/hefeng6500/3105475)。

| 属性名 | 属性说明 | 备注 |
| ----- | ------ | ---- |
| `displayName` | 前端站点名称 | 在浏览器中将作为 title 显示 |
| `url` | 前端站点的访问地址，其路径相对于应用的 url | 以 `redirect:` 开头的，将视为外部站点，在访问站点时直接跳转 |
| `layout` | 前端站点的布局 DSL 路径。在访问站点时，后端根据该布局文件和站点下的资源生成站点主页面，资源的布局由该主页面控制 | 布局可拆分为上下左右等多个部分以共用 |

- `site.resource` 属性列表

> 资源一般为导航菜单。

| 属性名 | 属性说明 | 备注 |
| ----- | ------ | ---- |
| `displayName` | 资源名称 | 一般作为导航菜单名称 |
| `url` | 资源的页面 DSL 路径 | 以 `redirect:` 开头的，将视为外部资源，在访问时直接跳转 |
